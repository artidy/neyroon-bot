generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserStatus {
  NEW
  TRIAL
  ACTIVE
  EXPIRED
  BLOCKED
}

enum LessonType {
  FREE
  PREMIUM
}

model User {
  id                String       @id @default(cuid())
  telegramId        BigInt       @unique
  username          String?
  firstName         String?
  lastName          String?
  status            UserStatus   @default(NEW)
  isNewbie          Boolean?
  preferredTime     String?      @default("10:00")
  timezone          String       @default("Asia/Almaty")
  currentLessonDay  Int          @default(0)
  acceptedPolicy    Boolean      @default(false)
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  lastActivityAt    DateTime     @default(now())

  subscriptions     Subscription[]
  drawings          Drawing[]
  paymentRequests   PaymentRequest[]

  @@index([telegramId])
  @@index([status])
}

model Subscription {
  id                String       @id @default(cuid())
  userId            String
  user              User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  price             Int
  currency          String       @default("KZT")
  paymentProvider   String
  paymentId         String?
  status            String       @default("pending")

  startDate         DateTime?
  endDate           DateTime?

  deletedAt         DateTime?    // –î–ª—è –º—è–≥–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è

  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  @@index([userId])
  @@index([status])
  @@index([deletedAt])
}

model PaymentRequest {
  id                String       @id @default(cuid())
  userId            String
  user              User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  paymentMethodId   String
  price             Int
  currency          String
  paymentMethodName String       // –ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã (Kaspi, Tinkoff –∏ —Ç.–¥.)
  paymentUrl        String       // –°—Å—ã–ª–∫–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –ø–µ—Ä–µ—à—ë–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

  status            String       @default("pending") // pending, confirmed, rejected, cancelled

  adminNotified     Boolean      @default(false)
  notifiedAt        DateTime?

  confirmedBy       String?      // Telegram ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª
  confirmedAt       DateTime?

  deletedAt         DateTime?    // –î–ª—è –º—è–≥–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è

  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@index([deletedAt])
}

model Lesson {
  id                String       @id @default(cuid())
  lessonNumber      Int          @unique
  type              LessonType
  title             String?
  description       String?

  previewVideoUrl   String?
  fullVideoUrl      String?
  practiceText      String?

  isActive          Boolean      @default(true)
  order             Int

  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  drawings          Drawing[]
  videos            LessonVideo[]

  @@index([lessonNumber])
  @@index([type])
}

model LessonVideo {
  id                String       @id @default(cuid())
  lessonId          String
  lesson            Lesson       @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  title             String
  videoUrl          String
  order             Int          @default(0)

  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  @@index([lessonId])
  @@index([order])
}

model Drawing {
  id                String       @id @default(cuid())
  userId            String
  user              User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  lessonId          String
  lesson            Lesson       @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  fileId            String
  filePath          String
  fileName          String

  comment           String?
  commentedAt       DateTime?
  commentedBy       String?

  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  @@index([userId])
  @@index([lessonId])
  @@index([createdAt])
}

model Admin {
  id                String       @id @default(cuid())
  username          String       @unique
  passwordHash      String
  email             String?      @unique

  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  @@index([username])
}

model BotSettings {
  id                String       @id @default(cuid())
  key               String       @unique

  // –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–≤–æ–π)
  policyText        String?      // –¢–µ–∫—Å—Ç –ø–æ–ª–∏—Ç–∏–∫–∏ —Å –≤–æ–∑–º–æ–∂–Ω—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏
  policyButton      String @default("–Ø —Å–æ–≥–ª–∞—Å–µ–Ω")

  // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  welcomePhoto      String?      // URL –∏–ª–∏ file_id —Ñ–æ—Ç–æ
  welcomeText       String?      // –û–ø–∏—Å–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞/–∫—É—Ä—Å–∞
  welcomeButtonNewbie     String @default("–ù–æ–≤–∏—á–æ–∫")
  welcomeButtonExperienced String @default("–£–∂–µ –∑–Ω–∞–∫–æ–º")

  // –ë–ª–æ–∫ –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤ –ø–æ—Å–ª–µ FREE —É—Ä–æ–∫–æ–≤
  newbieCtaText     String @default("üëÜ –ü–æ—Å–º–æ—Ç—Ä–µ–ª–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —É—Ä–æ–∫–∏?\n\n–ì–æ—Ç–æ–≤—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –ø–æ–ª–Ω–æ–º—É –∫—É—Ä—Å—É?")
  newbieCtaButton   String @default("üöÄ –•–æ—á—É –≤ –ø—Ä–æ–µ–∫—Ç")

  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–ø–ª–∞—Ç—ã
  paymentText       String?      // –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ–ø–ª–∞—Ç–µ
  paymentPrice      Int?         // –¶–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏
  paymentCurrency   String @default("KZT")
  paymentDuration   Int @default(30) // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –¥–Ω—è—Ö
  adminTelegramId   String?      // Telegram ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  @@index([key])
}

model PaymentMethod {
  id                String       @id @default(cuid())
  name              String       // –ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ÆKassa")
  paymentUrl        String       // –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å {price} –¥–ª—è –∑–∞–º–µ–Ω—ã)
  buttonText        String       // –¢–µ–∫—Å—Ç –Ω–∞ –∫–Ω–æ–ø–∫–µ
  buttonColor       String       @default("primary") // –¶–≤–µ—Ç –∫–Ω–æ–ø–∫–∏: primary, secondary, positive, negative
  price             Int?         // –¶–µ–Ω–∞ –¥–ª—è —ç—Ç–æ–≥–æ –º–µ—Ç–æ–¥–∞ –æ–ø–ª–∞—Ç—ã (–µ—Å–ª–∏ null, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω–∞—è)
  currency          String?      // –í–∞–ª—é—Ç–∞ –¥–ª—è —ç—Ç–æ–≥–æ –º–µ—Ç–æ–¥–∞ (–µ—Å–ª–∏ null, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω–∞—è)
  isActive          Boolean      @default(true)
  order             Int          @default(0) // –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  @@index([order])
}
